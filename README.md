# Boa_Vue_Router
A Reconstruction Scheme for Router Web

**路由器web项目架构设计**

**2022-07-29 v0.4**

目录

[1. 前言 4](#_Toc22327)

[1.1 版本说明 4](#_Toc10459)

[1.2 目的说明 4](#_Toc20342)

[1.3 面向读者 4](#_Toc6466)

[2. 项目概述 5](#_Toc4728)

[2.1 项目需求分析 5](#_Toc13500)

[2.1.1 可行性分析 5](#_Toc12077)

[2.1.2 项目解决的问题 5](#_Toc15183)

[2.1.3 项目目标 5](#_Toc1784)

[2.1.4 项目成员及职责 5](#_Toc27779)

[2.2 技术选型 6](#_Toc22595)

[2.2.1 开发语言 6](#_Toc7693)

[前端 6](#前端)

[后端 6](#后端)

[2.2.2 开发规范 6](#_Toc2524)

[前端 6](#前端-1)

[后端 7](#后端-1)

[2.2.3 代码仓库 7](#_Toc20157)

[代码管理工具选择 7](#代码管理工具选择)

[Git协作流程规范 8](#git协作流程规范)

[2.2.4 开发流程规范 9](#_Toc26102)

[2.2.5 开源项目管理 9](#_Toc16858)

[2.2.6 前后端持续集成方案 9](#_Toc10755)

[2.2.7 其他 9](#_Toc14649)

[3. 架构设计 10](#_Toc17142)

[3.1 架构图分析 10](#_Toc5207)

[3.1.1 前后端分离整体架构 10](#_Toc22108)

[架构说明 10](#架构说明)

[3.1.2 前端架构设计 10](#_Toc32100)

[架构说明 12](#架构说明-1)

[MVC架构 14](#mvc架构)

[工程架构 15](#工程架构)

[3.1.3 后端架构设计 15](#_Toc27232)

[架构说明 16](#架构说明-2)

[3.2 系统架构实施 17](#_Toc14903)

[3.2.1 系统用例分析 17](#_Toc27262)

[Web用例分析 17](#web用例分析)

[Web功能分析 17](#web功能分析)

[3.2.2系统组件设计 18](#_Toc16424)

[登录 18](#登录)

[数据查询 19](#数据查询)

[数据设置 19](#数据设置)

[3.2.3系统拓展分析 20](#_Toc12465)

[安全性分析 20](#安全性分析)

[多国语言考虑 20](#多国语言考虑)

[浏览器兼容性考虑 20](#浏览器兼容性考虑)

[移动端兼容性考虑 20](#移动端兼容性考虑)

[其他 20](#其他-1)

[4. 项目工程安排 21](#_Toc25662)

[4.1 基于API的开发模式 21](#41-基于api的开发模式)

[4.1.1 开发过程分析 22](#开发过程分析)

[4.1.2 API接口设计 22](#api接口设计)

[前端RESTful API封装 22](#前端restful-api封装)

[后端RESTful API封装 22](#后端restful-api封装)

[4.2 工程安排 23](#42-工程安排)

[4.2.1工作量分析 23](#421工作量分析)

[前端 23](#前端-2)

[后端 23](#后端-2)

[测试 23](#测试)

[4.2.2项目人力预计 23](#422项目人力预计)

[4.2.3项目后继安排 24](#423项目后继安排)

# 前言

## 版本说明

| **版本号** | **版本时间** | **版本备注**       | **版本作者** |
|------------|--------------|--------------------|--------------|
| V0.1       | 2022-7-15    | 文档初版，草稿版   | 冯读硕       |
| V0.2       | 2022-7-16    | 增加后续时间安排   | 冯读硕       |
| V0.3       | 2022-7-22    | 一些细节描述修改   | 冯读硕       |
| V0.4       | 2022-7-29    | 增加兼容性相关考虑 | 冯读硕       |

## 目的说明

本文档旨在对路由器web项目进行架构设计说明、技术选型说明、开发流程说明以及整体结构说明，并针对项目进展进行人力安排分析。

## 面向读者

本项目开发人员、项目测试人员、项目管理人员以及公司内部开发者和管理者。

# 项目概述

## 项目需求分析

### 可行性分析

根据公司的反馈，我们知道当前该型号的路由器业务需求量还是比较大的，可以占有很大程度上的市场空间，所以针对当前路由器上存在的web界面的问题进行分析解决，最终在项目完成后可以在实际中有很好的推广，具有**市场可行性**。从技术层面来讲，目前路由器中使用的前后端技术耦合性太强，不利于迁移和拓展，而使用新的前端技术例如Vue可以通过组件化的形式在很大程度上降低耦合程度，提高内聚性。另外按照RESTful API规范提供出结构清晰、符合标准、易于理解、扩展方便的接口也将进一步提高项目的实用价值。因此，本项目也具有**技术可行性**。

### 项目解决的问题

当前路由器web项目中前后端代码**耦合程度**过高，想要增加、删除或是修改功能项十分困难，不适合进行维护或是迁移到其他项目中。因此，本此web重建项目主要针对现在路由器前后端存在的问题提出**低耦合高内聚**的解决办法，并进行**持续开发**和**后期维护**。

### 项目目标

将原本的路由器web前后端耦合的部分完全**解耦**出来，维持前后端的**数据一致性**，基于**RESTful API**完成前后端的数据交流和业务处理。开发**逻辑清晰**且**易于维护**的前后端代码，在规定期限完成项目的所有开发任务。

### 项目成员及职责

| **姓名** | **项目组角色** | **分工**                 |
|----------|----------------|--------------------------|
|          | 主管           | 监督，方向掌控           |
|          | 组长           | 双向沟通，统筹           |
|          | 成员           | 文档输出，接口设计，前端 |
|          | 成员           | 后端，接口               |
|          | 成员           | 测试，接口               |

## 技术选型

### 开发语言

#### 前端

前端开发主要基于Vue框架：

**脚手架**：围绕Vue技术栈，采用Vue Cli脚手架工具来快速构建基础工程。

**UI组件库**：可以根据需求选择现有UI组件库，如ElementUI等。

**路由管理**：路由控制采用Vue Router。

**状态管理**：统一集中管理项目中组件状态采用Vuex。

**异步请求**：异步请求采用axios。

**工具库**：待定。

**样式管理和静态资源**：待定。

#### 后端

后端开发主要采用基于C语言的boa cgi方式：

细节待定。

### 开发规范

#### 前端

**开发工具**：暂定VS Code（也可以通过配置editorconfig的方式支持不同IDE统一代码风格）。

**ESLint**：编码过程中，代码规范，提高代码可读性，采用airbnb/javascript这套代码规范（暂定）。

**Prettier**：采用Vetur插件实现代码质量和错误提示，智能提示格式化。

**静态资源**：图片资源统一（待定）。

**目录规范**：

如：

| src  \|-assets 静态资源管理  \|-components 公用组件管理  \|-router 路由管理  \|-store vuex管理  \|-utils 工具方法管理 |
|-----------------------------------------------------------------------------------------------------------------------|

**代码规范**：

1.  统一使用2个占位符缩进。
2.  统一使用UTF-8字符编码。
3.  js 代码末尾加分号。
4.  变量命名采用驼峰式命名，常量大写。
5.  data的使用，在组件中使用data属性时，data设为函数。

| data () {  return {  msg: 'hello fengdushuo'  }  } |
|----------------------------------------------------|

1.  公共方法抽取封装到utils文件目录中。
2.  组件特有样式设置独立作用域。
3.  关键的注释。
4.  其他待定。

**命名规则：**

1.  目录命名：

小驼峰命名法，如： userDetail。

1.  Vue组件命名：

大驼峰命名法，如：MyComponent.vue。

1.  Method自定义函数，data属性等：

小驼峰命名法，如： currentIndex。

#### 后端

**开发工具**：LInux环境下：GCC，GDB，make等。Windows环境下：待定（dev-C++,VS Code）。

**代码规范**：参考公司的C语言开发语言规范。

### 代码仓库

#### 代码管理工具选择

代码仓库采用Git进行管理。原因如下：方便的分支切换、版本回滚；更好地规范化版本日志；更多开源免费的配套设施（如Gitlab）；适合实行 Code Review；规范化开发流程 Git-Flow。

Git项目地址：<https://github.com/FengDushuo/AX3000_Web> （暂定）

#### Git协作流程规范

使用 GitLab 托管代码。

**Root仓库：**项目启动时，由项目管理者搭建起最原始的仓库，称为 Root 仓库（源仓库）。

**Root仓库的作用** : 汇总参与该项目的各个开发者的代码。存放趋于稳定和可发布的代码。向 Master 分支提交 Merge Requests 可以触发测试环境构建（CI/CD）。源仓库是受保护的，开发者不可直接对其进行开发工作。

**Fork仓库：**开发者没有权限对 Root 仓库进行直接的操作，源仓库建立以后，每个开发者把源仓库的 Fork 一份，作为自己日常开发的仓库。

**Fork仓库的作用** : 每个开发者所Fork的仓库是完全独立的。每个开发者提交到代码到自己的仓库中，开发工作完成以后，开发者可以向源仓库发送 Pull Request ，本地仓库先合并源仓库，解决冲突。发起 Merge Request 请求管理员把自己的代码合并到源仓库中的 master 或其他分支。

**Git流程**大致如下：

![git](https://github.com/FengDushuo/Boa_Vue_Router/tree/main/media/33189322e21e663303067cd569d37653.png)

**Git流程规范：**

1.  前端项目会在 Root 仓库下创建 dev 分支，用于代码的拉取和合并，如果有多个不同的测试环境，按照测试环境创建分支。
2.  在本地的仓库中创建各自的 dev 分支和其他功能性的分支。
3.  开发过程中不允许直接在 master 分支上开发，创建一个新的分支进行开发。
4.  规范书写 commit 。
5.  完成开发后将相应的分支合并到自己仓库的 master 分支。
6.  将 master 分支 push 到自己的远程仓库（Fork仓库）。
7.  向 Root 仓库 dev 分支提交 Merge Requests。
8.  提醒前端负责人审查代码、解决冲突或测试环境上线。
9.  解决冲突后 git pull upstream dev 拉取解决后的最新代码。

### 开发流程规范

需求分析，开发，测试，上线的流程规范：

![team_workflow](https://github.com/FengDushuo/Boa_Vue_Router/tree/main/media/cf5529ec262664b801a96515b7d011ee.png)

### 开源项目管理

对于在项目中引入的一些开源库进行管理，方式待定。

### 前后端持续集成方案

待定。可以暂时使用Git的管理方式进行约束。

### 其他

待定。

# 架构设计

## 3.1 架构图分析

### 前后端分离整体架构

项目采用前后端分离的开发方式，整体架构如图所示：

![structure_whole](https://github.com/FengDushuo/Boa_Vue_Router/tree/main/media/7280b97321181b60fd327fca5ea8782c.png)

#### 架构说明

架构关键设计点：

1.  前后端分离设计，前端和后端各自完成开发，以接口形式进行数据传递。
2.  前端使用Vue进行开发，遵循轻巧、高性能、可组件化的MVVM框架。
3.  后端使用boa服务器转发请求，获取客户端提交的信息，转交给服务器端的CGI程序进行处理。
4.  CGI与业务系统通过内部接口进行数据传递并交互处理业务逻辑。

### 前端架构设计

前端使用Vue技术，采用MVVM框架以提高效率、提升性能、提高可扩展性、防止重复造轮子、提高可维护性。MVVM框架实现了数据与视图的分离，通过数据来驱动视图，封装DOM操作。MVVM框架的大致示意图如图所示：

![vue](https://github.com/FengDushuo/Boa_Vue_Router/tree/main/media/9cbcb5544a644ca9da6820e8339d8827.png)

项目前端基于Vue框架进行开发，其架构如图所示：

![structures_web](https://github.com/FengDushuo/Boa_Vue_Router/tree/main/media/d0891e459915f9afc349f129dc66205a.png)

#### 架构说明

1.  首先浏览器发送请求，单页应用程序 (SPA) 加载单个HTML 页面并在用户与应用程序交互时动态更新该页面。浏览器一开始会加载必需的模块。
2.  因为SPA利用JS动态变换HTML，实现UI与用户的交互，应用加载之后不会再有整页刷新。各页面的js模块可以各自独立开发。

![SPA](https://github.com/FengDushuo/Boa_Vue_Router/tree/main/media/2a0cfe862a2435ad546e3e13c4335ccd.png)

1.  前端设定为vue + webpack 的 SPA，通过 node 和 webpack 的支持把 vue 组件 build 打包成传统元素，发布到 http 服务中，请求后端服务。WebPack 可以看做是模块打包机器，它可以分析项目结构，找到 JavaScript 模块以及其它的一些浏览器不能直接运行的拓展语言：Stylus、Scss、less、TypeScript、CoffeeScript 等，并将其转换和打包为合适的格式供浏览器使用。WebPack 是一种模块化开发的方案。
2.  页面容器层包括Vue Component，Vue Router，Vuex，以及拓展的一些UI组件库。 组件 (Component) 是 Vue.js 最强大的功能之一。组件可以扩展 HTML 元素，封装可重用的代码。在较高层面上，组件是自定义元素，Vue.js 的编译器为它添加特殊功能。组件使用如下：

![vue component](https://github.com/FengDushuo/Boa_Vue_Router/tree/main/media/6f95a92e34f00cc5ba092ac4a9e6c65a.png)

vue-router是Vue.js官方的路由插件，它和vue.js是深度集成的，适合用于构建单页面应用。

![vue router](https://github.com/FengDushuo/Boa_Vue_Router/tree/main/media/75bb06a4b8e74125fcc85cd210cfff24.png)

vuex为vue的一个插件,用来管理共享数据的,局部数据声明在自己组件内部。

![vuex](https://github.com/FengDushuo/Boa_Vue_Router/tree/main/media/dd88db013ea2c534fca60e3781427e0e.png)

1.  vue项目工程中，有很多公用的js函数，为了便于集中管理，可以在utils层统一管理。
2.  中间件和数据过滤器。
3.  使用Axios发送网络请求。

#### MVC架构

![structure_other](https://github.com/FengDushuo/Boa_Vue_Router/tree/main/media/052c1e68063cc99a14fc7d714e643dc4.png)

#### 工程架构

![structure_project](https://github.com/FengDushuo/Boa_Vue_Router/tree/main/media/43803bb2ea82c9fc9083d36e62477864.png)

### 后端架构设计

后端设计依托boa服务器和CGI，整体架构如图所示：

![boa_cgi](https://github.com/FengDushuo/Boa_Vue_Router/tree/main/media/56daec04ab5c3aa8e7ff78a6253f729b.png)

#### 架构说明

Boa服务器的大致工作流程：

![safe_boa_flow](https://github.com/FengDushuo/Boa_Vue_Router/tree/main/media/cb07161da25b2ac2937268d30cd269f4.png)

Boa从新到达的套接字获得HTTP请求(由一个request结构来存储)，并将其保存在队列当中。首先，get_request()将从套接字获得的数据全部保存在request→header_line中，然后调用process_request()来处理在队列中的每一个请求。根据request结构中status所表示的不同状态，将进行不同的处理。如果这个请求符合HTTP协议，则会调用process_option_Iine()将一些头部信息填写到request结构中完成这些环境变量的设置，随后process_header_end()会对用户进行验证。如果验证通过则判断request结构中的is_cgi，若是CGI程序，则调用init_cgi()函数进行处理。

对CGI程序的处理函数init_cgi()首先调用一系列函数完成对CGI环境变量的设置，create_common_env()，complete_env()完成了大多数CGI环境变量的注册工作。采用PIPE(管道)方式，就是将CGI程序的输出重定向到管道，然后Boa从管道读取并转发给客户端浏览器。整个流程结束后，返回到主函数的无限循环中等待处理下一个套接字连接的到达。init_cgi()具体工作流程如图所示：

![init_cgi](https://github.com/FengDushuo/Boa_Vue_Router/tree/main/media/4df028c2e6a00dff856b500929a6caa2.png)

## 系统架构实施

### 3.2.1 系统用例分析

#### Web用例分析

![yongli](https://github.com/FengDushuo/Boa_Vue_Router/tree/main/media/87c94c396dce9f287c6e8a19f4fdc229.png)

#### Web功能分析

1.  登录：用户登入web平台，在有身份有效期内保持登陆状态，并可对路由器进行查询和设置操作。
2.  主页：查询路由器连接状态，运行状态和终端连接状态等。
3.  上网设置：设置上网模式，IP协议，静态DNS等。
4.  Wifi设置：设置wifi模式，wifi名称，wifi密码等。
5.  终端管理：管理在线终端等。
6.  Mesh管理：设置Mesh组网等。
7.  状态：查询设备信息，网络侧信息，用户侧信息和远程管理状态等。
8.  网络：设置LAN侧地址配置，WLAN-2.4G/5G配置，Wifi高级设置，时间管理和WOLINK配置等。
9.  安全：设置URL过滤和防火墙等。
10. 应用：设置高级NAT配置，IPTV配置，IGMP设置，MESH拓扑图等。
11. 管理：设置用户管理，升级管理，设备管理和日志文件管理等。
12. 诊断：设置网络诊断等。
13. 帮助：提供功能介绍。

### 3.2.2系统组件设计

目前暂时将系统组件划分为登录，数据查询和数据设置三个主板块。其中数据查询和数据设置板块会分化为具体功能的各个组件。

#### 登录

登录模块涉及登录页面的整体逻辑和登录状态的保持。登录鉴权方式暂定为JWT（JSON Web Token）方式。JWT鉴权流程如图所示：

![login_token](https://github.com/FengDushuo/Boa_Vue_Router/tree/main/media/717f8ebb0c26232aea99d23641ee580b.png)

登录流程图如下所示：

![login_logic](https://github.com/FengDushuo/Boa_Vue_Router/tree/main/media/a8114a086c1428841c59e6544189e9b1.png)

这里注册的流程如果不必要我们可以去除。

登录模块至少包含两个字段：用户名：userName (String)；密码：passWord (String)。

#### 数据查询

数据查询模块涉及数据在前后端之间的传递，主要是后端向前端传递数据并由前端呈现出来。数据查询前后端通信流程图如下：

![data_get_logic](https://github.com/FengDushuo/Boa_Vue_Router/tree/main/media/16383856936fa1046912302966f661b8.png)

数据查询模块至少包含两个参数：token (String); pageName (String)。

#### 数据设置

数据设置模块涉及数据在前后端之间的传递，主要是前端向后端传递数据并由后端逻辑将配置设置到后台。数据设置前后端通信流程图如下：

![data_set_logic](https://github.com/FengDushuo/Boa_Vue_Router/tree/main/media/00c39bec70a982646b7e91e1b0a44c3a.png)

数据查询和数据设置过程中涉及到数据集的双向绑定，基于Vue的数据双向绑定流程图如下所示：

![data_interaction](https://github.com/FengDushuo/Boa_Vue_Router/tree/main/media/d2e39c40e87768d33db9ba53771d1f15.png)

### 3.2.3系统拓展分析

#### 安全性分析

鉴权方式：JWT。

网络攻击防御：待定。

#### 多国语言考虑

Vue实现多国语言兼容：vue-i18n等。

#### 浏览器兼容性考虑

Vue支持所有兼容ECMAScript5的浏览器，因IE8不支持ECMAScript5特性，故IE8及其以下浏览器均不支持Vue。

采用Vue CLI 3为浏览器兼容提供解决方案，提供包括Browserslist、Babel、@Babel/preset-env以及现代模式来共同处理浏览器兼容性。CLI3构建出的工程会利用Browserslist去进行浏览器查询(包括类型和版本)，然后结合预设对Babel进行配置共同来针对目标环境对源代码进行转译或引入Polyfills来解决兼容性问题。现代模式同样会根据这些设定以及目标环境去构建出适合运行在支持项目所有新特性的浏览器以及不支持特性的浏览器的两种包。

#### 移动端兼容性考虑

vue开发移动端页面时，需要实现页面根据不同设备屏幕进行尺寸的适配，实现将px自动换算成rem单位。px2rem-loader 插件和lib-flexible 插件可快速实现移动端适配问题。

#### 其他

待商议。

# 项目工程安排

## 4.1 基于API的开发模式

目前我们考虑基于RESTful API规范围绕API展开开发工作。前端、后端和测试人员围绕API工作的逻辑图如下所示：

![api_flow](https://github.com/FengDushuo/Boa_Vue_Router/tree/main/media/6366d2805b1d4d9a6aa12135310cc715.png)

在开发过程中前端、后端和测试人员分别要对API进行定义、设计、开发和测试，而主流的开发合作图如下所示

![API_work_team](https://github.com/FengDushuo/Boa_Vue_Router/tree/main/media/c4791de86b84e35addc409ea1dced6a2.png)

### 开发过程分析

设计阶段：

1.  根据需求文档确定接口设计思路。
2.  接口设计者定好接口文档初稿。
3.  接口评审，完善接口文档，定好接口用例。

开发阶段：

1.  前端：根据接口文档生成mock数据，进入开发。
2.  后端：根据接口文档调试接口，每次调试一个功能就保存一个接口用例。更新接口文档。
3.  测试：根据接口用例生成测试用例。

联调和测试阶段：

1.  所有接口开发完之后，测试或后端人员使用集合测试功能进行多接口集成测试，完整测试整个接口调用流程。
2.  前后端开发完成之后，前端从mock数据切换到正式数据，可能存在的问题如数据不一致问题。
3.  回归测试和安全测试。

### API接口设计

根据路由器现有页面和数据进行接口设计。

#### 前端RESTful API封装

Vue使用axios封装RESTful风格API

Axios 是一个基于 promise 的 HTTP 库，可以用在浏览器和 node.js 中，基本请求有5种：

get：多用来获取数据

post：多用来新增数据

put：多用来修改数据（需要传递所有字段，相当于全部更新）

patch：多用来修改数据，是在put的基础上新增改进的，适用于局部更新

delete：多用来删除数据

axios其实和原生ajax，jquery中的\$ajax类似，都是用于请求数据的，不过axios是基于promise的，也是vue官方比较推荐的做法。在 axios 中使用 POST 提交数据时，数据会以 application/json 发送到后端，这是和传统的 form 表达那不同的地方。

#### 后端RESTful API封装

通过URL用来定位资源，跟要进行的操作区分开，这就意味着URL不该有任何动词，根据请求方法来区分增删改查。请求方法：GET，POST，PUT，DELETE，PATCH。

## 4.2 工程安排

### 4.2.1工作量分析

本项目包含前端后端和测试从三个方面，以下进行工作量分析。

#### 前端

前端工作量体现在代码的重构上，原始web项目大致由63个子页面。后期可以用侧边导航栏的方式将子页面整合到一个页面，但是各个页面的组件要独立开发。其次，前端接口的封装也由一定的工作量。

#### 后端

后端工作量体现在服务器代码的解耦和后端接口的开发上。目前项目中web前后端和业务逻辑代码耦合程度较高，代码不易读，逻辑较为复杂，所以需要时间来分析核心代码所依赖的函数并进行分析和解耦。

#### 测试

测试的工作量在于模拟现实环境对项目进行全方位测试，并且需要持续在项目中跟进。

### 4.2.2项目人力预计

| **项目分工** | **人力预计（人\*天）** | **月数（按每月10天计算）** |
|--------------|------------------------|----------------------------|
| 设计         | 15                     | 1.5                        |
| 前端         | 20                     | 2                          |
| 后端         | 30                     | 3                          |
| 测试         | 10                     | 1                          |

### 4.2.3项目后继安排

| **时间**  | **事项**                               | **备注**             |
|-----------|----------------------------------------|----------------------|
| 7.16-8.1  | 接口设计文档、评议、决定               |                      |
| 8.1-8.10  | 登录界面和首页前后端设计并开发测试     | 前后端分离，并行开发 |
| 8.10-9.20 | 前端页面基本开发完成，后端接口基本适配 | 单元测试             |
| 9.20-10.1 | 前后端基本开发完成，测试基本完成       | 集成测试             |
|           |                                        |                      |
|           |                                        |                      |
|           |                                        |                      |
